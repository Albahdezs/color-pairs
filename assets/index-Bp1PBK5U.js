var L=Object.defineProperty;var v=r=>{throw TypeError(r)};var b=(r,e,t)=>e in r?L(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var a=(r,e,t)=>b(r,typeof e!="symbol"?e+"":e,t),E=(r,e,t)=>e.has(r)||v("Cannot "+t);var i=(r,e,t)=>(E(r,e,"read from private field"),t?t.call(r):e.get(r)),c=(r,e,t)=>e.has(r)?v("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),n=(r,e,t,s)=>(E(r,e,"write to private field"),s?s.call(r,t):e.set(r,t),t);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const l of o)if(l.type==="childList")for(const I of l.addedNodes)I.tagName==="LINK"&&I.rel==="modulepreload"&&s(I)}).observe(document,{childList:!0,subtree:!0});function t(o){const l={};return o.integrity&&(l.integrity=o.integrity),o.referrerPolicy&&(l.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?l.credentials="include":o.crossOrigin==="anonymous"?l.credentials="omit":l.credentials="same-origin",l}function s(o){if(o.ep)return;o.ep=!0;const l=t(o);fetch(o.href,l)}})();function M(r){let e=r.length;for(;e!=0;){let t=Math.floor(Math.random()*e);e--,[r[e],r[e]]=[r[t],r[e]]}}var S,w,g,f,h,d;class B{constructor(e,t,s,o=!0,l=!1){c(this,S);c(this,w);c(this,g);c(this,f);c(this,h);c(this,d);n(this,S,t),n(this,w,e),n(this,g,s),n(this,f,o),n(this,h,l)}get col(){return i(this,S)}get row(){return i(this,w)}set element(e){n(this,d,e)}get open(){return i(this,h)}get free(){return i(this,f)}get color(){return i(this,g)}set free(e){n(this,f,e)}addEventClick(){i(this,d)&&i(this,d).addEventListener("click",e=>(i(this,h)||(i(this,d).style.backgroundColor=i(this,g),n(this,h,!0),console.log("Has hecho click en un tarjeta.")),!1))}resetColor(){i(this,d).style.backgroundColor="black",n(this,h,!1)}}S=new WeakMap,w=new WeakMap,g=new WeakMap,f=new WeakMap,h=new WeakMap,d=new WeakMap;class T{constructor(e="timer"){a(this,"min");a(this,"sec");a(this,"ms");a(this,"count");a(this,"malt");a(this,"salt");a(this,"msalt");a(this,"idElement");a(this,"isRunning",!1);console.log("Creamos un timer."),this.idElement=e;const t=localStorage.getItem("timer");if(t)try{let s=JSON.parse(t);this.sec=parseInt(s.sec)||0,this.min=parseInt(s.min)||0,this.ms=parseInt(s.ms)||0}catch(s){console.error("Error al parsear el timer desde localStorage",s),this.ms=0,this.min=0,this.sec=0}else this.ms=0,this.min=0,this.sec=0}start(){this.isRunning||(this.isRunning=!0,this.count=setInterval(()=>{this.ms===100?(this.ms=0,this.sec===60?(this.sec=0,this.min++):this.sec++):this.ms++,this.malt=this.pad(this.min),this.salt=this.pad(this.sec),this.msalt=this.pad(this.ms),this.update(this.malt+":"+this.salt+":"+this.msalt)},10))}stop(){clearInterval(this.count),this.isRunning=!1}update(e){let t=document.getElementById(this.idElement);t.firstChild.nodeValue=e;let s={sec:this.sec,min:this.min,ms:this.ms};localStorage.setItem("timer",JSON.stringify(s))}pad(e){let t;return e<10?t="0"+e:t=e,t}}var u,p,y,m;class C{constructor(e,t,s="game"){c(this,u);c(this,p);c(this,y);c(this,m);a(this,"element");a(this,"timer");n(this,u,e),n(this,p,t),n(this,y,s),this.element=document.getElementById(s),n(this,m,[]),this.createBoxes(),this.paintBoxes(),console.log("Se ha creado un objeto de tipo Game"),this.element.addEventListener("click",()=>{this.checkOpenBoxes()}),this.initTimer()}get col(){return i(this,p)}get row(){return i(this,u)}checkOpenBoxes(){this.timer.isRunning||(this.timer.start(),this.timer.isRunning=!0);let e=i(this,m).filter(t=>t.open&&t.free);e.length==2&&(e[0].color===e[1].color?e.map(t=>{t.free=!1}):setTimeout(()=>{e.map(t=>{t.resetColor()})},500)),this.arrayBoxesToLocalStorage(),i(this,m).every(t=>!t.free)&&(this.timer.stop(),this.showVictoryMessage())}showVictoryMessage(){let e=document.getElementById("boxHeader"),t=document.createElement("div");t.setAttribute("id","victoryMessage"),t.innerHTML=`<h3>¡Felicidades! Has ganado el juego en ${this.timer.min}:${this.timer.pad(this.timer.sec)}:${this.timer.pad(this.timer.ms)}.</h3>`,e.appendChild(t)}createRandomColors(){let e=[];for(let t=0;t<i(this,p)*i(this,u)/2;t++){let s=Math.floor(Math.random()*256),o=Math.floor(Math.random()*256),l=Math.floor(Math.random()*256),I=`rgb(${s}, ${o}, ${l})`;e.push(I)}return e=[...e,...e],M(e),e}createBoxes(){if(n(this,m,[]),localStorage.getItem("boxes")!==null)JSON.parse(localStorage.getItem("boxes")).map(t=>{let s=new B(t.row,t.col,t.color,t.free,t.open);i(this,m).push(s)});else{let e=this.createRandomColors();for(let t=0;t<i(this,u);t++)for(let s=0;s<i(this,p);s++){let o=e.shift(),l=new B(t,s,o);i(this,m).push(l)}this.arrayBoxesToLocalStorage()}}arrayBoxesToLocalStorage(){let e=i(this,m).map(t=>({row:t.row,col:t.col,color:t.color,free:t.free,open:t.open}));localStorage.setItem("boxes",JSON.stringify(e))}paintBoxes(){let e=document.createElement("header");e.setAttribute("id","boxHeader"),this.element.appendChild(e);let t=document.createElement("div");t.setAttribute("id","boxContainer"),this.element.appendChild(t),this.setCSSBoxTemplate(),i(this,m).map(s=>{let o=document.createElement("div");o.classList.add("box"),(!s.free||s.open)&&(o.style.backgroundColor=s.color),s.element=o,s.addEventClick(),t.appendChild(o)})}initTimer(){let e=document.createElement("h2");e.setAttribute("id","timerContainer"),e.innerHTML='<span id="timer">00:00:00</span>',document.getElementById("boxHeader").appendChild(e),this.timer=new T,this.timer.stop(),document.addEventListener("resetGame",()=>{this.timer.stop()})}setCSSBoxTemplate(){let e=document.getElementById("boxContainer");e.style.gridTemplateColumns=`repeat(${i(this,p)}, 1fr)`,e.style.gridTemplateRows=`repeat(${i(this,u)}, 1fr)`}static getRowsCols(){let e,t;if(localStorage.getItem("rows")!==null&&localStorage.getItem("cols")!==null)e=parseInt(localStorage.getItem("rows")),t=parseInt(localStorage.getItem("cols"));else{for(e=parseInt(prompt("Introduzca el número de filas")),t=parseInt(prompt("Introduzca el número de columnas"));e*t%2!=0;)alert("El número de cartas deben ser par. Vuelva a introducir los datos"),e=parseInt(prompt("Introduzca el número de filas")),t=parseInt(prompt("Introduzca el número de columnas"));localStorage.setItem("rows",e),localStorage.setItem("cols",t)}return{rows:e,cols:t}}static resetGame(){document.dispatchEvent(new Event("resetGame")),localStorage.removeItem("cols"),localStorage.removeItem("rows"),localStorage.removeItem("boxes"),localStorage.removeItem("timer"),location.reload()}}u=new WeakMap,p=new WeakMap,y=new WeakMap,m=new WeakMap;let x=C.getRowsCols();new C(x.rows,x.cols,"game");let O=document.getElementById("reset");O.addEventListener("click",()=>{C.resetGame()});
